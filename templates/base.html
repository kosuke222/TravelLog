<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KouHina App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    {% block head %}{% endblock %}
  </head>
  <body>
    <div class="bg-orbit"></div>
    <header class="site-header">
      <div class="logo-row">
        <button class="button ghost image-next" type="button" id="image-switch" hidden>次の画像</button>
        <div class="logo">KouHina App</div>
        <button class="button ghost image-reveal" type="button" aria-controls="image-switch" aria-expanded="false">画像切替</button>
      </div>
      <nav class="nav">
        <a href="{{ url_for('home') }}" class="{% if request.endpoint == 'home' %}active{% endif %}" {% if request.endpoint == 'home' %}aria-current="page"{% endif %}>ホーム</a>
        <a href="{{ url_for('schedule') }}" class="{% if request.endpoint in ['schedule', 'schedule_edit'] %}active{% endif %}" {% if request.endpoint in ['schedule', 'schedule_edit'] %}aria-current="page"{% endif %}>予定</a>
        <a href="{{ url_for('places') }}" class="{% if request.endpoint in ['places', 'places_edit'] %}active{% endif %}" {% if request.endpoint in ['places', 'places_edit'] %}aria-current="page"{% endif %}>行きたい所</a>
        <a href="{{ url_for('memo') }}" class="{% if request.endpoint == 'memo' %}active{% endif %}" {% if request.endpoint == 'memo' %}aria-current="page"{% endif %}>メモ</a>
        <a href="{{ url_for('games') }}" class="{% if request.endpoint == 'games' %}active{% endif %}" {% if request.endpoint == 'games' %}aria-current="page"{% endif %}>ゲーム</a>
      </nav>
    </header>

    <main class="page">
      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <span>遊びと管理をひとつに。</span>
    </footer>

    <div class="confirm-modal is-hidden" id="confirm-modal" role="dialog" aria-modal="true">
      <div class="confirm-card">
        <p>削除してもよろしいですか？</p>
        <div class="confirm-actions">
          <button class="button ghost" type="button" id="confirm-cancel">キャンセル</button>
          <button class="button danger" type="button" id="confirm-ok">削除</button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const dangerButtons = document.querySelectorAll("form button.button.danger");
        const confirmModal = document.getElementById("confirm-modal");
        const confirmCancel = document.getElementById("confirm-cancel");
        const confirmOk = document.getElementById("confirm-ok");
        let pendingForm = null;
        dangerButtons.forEach((button) => {
          const form = button.closest("form");
          if (!form) return;
          form.addEventListener("submit", (event) => {
            if (!confirmModal) return;
            event.preventDefault();
            pendingForm = form;
            confirmModal.classList.remove("is-hidden");
          });
        });
        if (confirmCancel && confirmModal) {
          confirmCancel.addEventListener("click", () => {
            pendingForm = null;
            confirmModal.classList.add("is-hidden");
          });
        }
        if (confirmOk && confirmModal) {
          confirmOk.addEventListener("click", () => {
            if (pendingForm) {
              pendingForm.submit();
              pendingForm = null;
            }
            confirmModal.classList.add("is-hidden");
          });
        }

        const revealButton = document.querySelector(".image-reveal");
        const nextButton = document.querySelector(".image-next");
        if (revealButton && nextButton) {
          revealButton.addEventListener("click", () => {
            if (nextButton.hasAttribute("hidden")) {
              nextButton.removeAttribute("hidden");
              revealButton.setAttribute("aria-expanded", "true");
            }
          });
          nextButton.addEventListener("click", () => {
            if (typeof window.__applyDailyImage === "function") {
              window.__applyDailyImage();
            }
          });
        }
      });
    </script>
  </body>
</html>
