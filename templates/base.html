<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TravelLog</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    {% block head %}{% endblock %}
  </head>
  <body>
    <div class="bg-orbit"></div>
    <header class="site-header">
      <div class="logo-row">
        <div class="logo">TravelLog</div>
        {% if active_trip %}
          <a class="trip-badge" href="{{ url_for('trips') }}">{{ active_trip.name }}</a>
        {% else %}
          <a class="trip-badge" href="{{ url_for('trips') }}">旅行を選択</a>
        {% endif %}
      </div>
      <nav class="nav">
        <a href="{{ url_for('home') }}" class="{% if request.endpoint == 'home' %}active{% endif %}" {% if request.endpoint == 'home' %}aria-current="page"{% endif %}>ホーム</a>
        <a href="{{ url_for('places') }}" class="{% if request.endpoint in ['places', 'places_edit'] %}active{% endif %}" {% if request.endpoint in ['places', 'places_edit'] %}aria-current="page"{% endif %}>行きたい</a>
        <a href="{{ url_for('schedule') }}" class="{% if request.endpoint in ['schedule', 'schedule_edit'] %}active{% endif %}" {% if request.endpoint in ['schedule', 'schedule_edit'] %}aria-current="page"{% endif %}>プラン</a>
        <a href="{{ url_for('hotels') }}" class="{% if request.endpoint == 'hotels' %}active{% endif %}" {% if request.endpoint == 'hotels' %}aria-current="page"{% endif %}>ホテル</a>
        <a href="{{ url_for('flights') }}" class="{% if request.endpoint == 'flights' %}active{% endif %}" {% if request.endpoint == 'flights' %}aria-current="page"{% endif %}>フライト</a>
        <a href="{{ url_for('memo') }}" class="{% if request.endpoint == 'memo' %}active{% endif %}" {% if request.endpoint == 'memo' %}aria-current="page"{% endif %}>ノート</a>
      </nav>
      <div class="header-actions">
        {% if warika_url %}
          <a class="button ghost" href="{{ warika_url }}" target="_blank" rel="noopener">ワリカ</a>
        {% else %}
          <button class="button ghost is-disabled" type="button" disabled>ワリカ</button>
        {% endif %}
      </div>
    </header>

    <main class="page">
      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <span>旅の記録をゆっくり重ねていこう。</span>
    </footer>

    <div class="confirm-modal is-hidden" id="confirm-modal" role="dialog" aria-modal="true">
      <div class="confirm-card">
        <p>削除してもよろしいですか？</p>
        <div class="confirm-actions">
          <button class="button ghost" type="button" id="confirm-cancel">キャンセル</button>
          <button class="button danger" type="button" id="confirm-ok">削除</button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const dangerButtons = document.querySelectorAll("form button.button.danger");
        const confirmModal = document.getElementById("confirm-modal");
        const confirmCancel = document.getElementById("confirm-cancel");
        const confirmOk = document.getElementById("confirm-ok");
        let pendingForm = null;
        dangerButtons.forEach((button) => {
          button.addEventListener("click", (event) => {
            if (button.dataset.confirm === "false") {
              return;
            }
            if (!confirmModal) return;
            event.preventDefault();
            pendingForm = button.form || button.closest("form");
            if (pendingForm) {
              confirmModal.classList.remove("is-hidden");
            }
          });
        });
        if (confirmCancel && confirmModal) {
          confirmCancel.addEventListener("click", () => {
            pendingForm = null;
            confirmModal.classList.add("is-hidden");
          });
        }
        if (confirmOk && confirmModal) {
          confirmOk.addEventListener("click", () => {
            if (pendingForm) {
              pendingForm.submit();
              pendingForm = null;
            }
            confirmModal.classList.add("is-hidden");
          });
        }
      });
    </script>
  </body>
</html>
