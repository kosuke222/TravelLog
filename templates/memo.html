{% extends "base.html" %}

{% block content %}
  <section class="page-header">
    <div>
      <p class="eyebrow">Shared Notes</p>
      <h1>共有ノート</h1>
      <p class="lead">予定や連絡事項をひとまとめに残せます。</p>
    </div>
  </section>

  <section class="panel form-panel">
    <form method="post" class="form-grid">
      <div>
        <label for="body">メモ</label>
        <textarea id="body" name="body" placeholder="行きたいこと、集合時間、注意点など" required></textarea>
      </div>
      <button class="button primary" type="submit">保存する</button>
    </form>
  </section>

  <section class="grid">
    {% for memo in memos %}
      <article class="panel memo-card memo-toggle">
        <div class="card-header">
          <h2>ノート</h2>
          <span class="meta">{{ memo["created_at"] }}</span>
        </div>
        <div class="memo-preview">{{ memo["body"][:80] }}{% if memo["body"]|length > 80 %}...{% endif %}</div>
        <div class="memo-body is-hidden">{{ memo["body"] }}</div>
        <form method="post" action="{{ url_for('memo_delete', memo_id=memo['id']) }}">
          <button class="button danger" type="submit">削除</button>
        </form>
      </article>
    {% else %}
      <article class="panel empty-state">
        <p>メモはまだありません。</p>
      </article>
    {% endfor %}
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const cards = document.querySelectorAll(".memo-toggle");
      cards.forEach((card) => {
        card.addEventListener("click", (event) => {
          if (event.target.closest("button, form, a")) {
            return;
          }
          const body = card.querySelector(".memo-body");
          if (!body) return;
          body.classList.toggle("is-hidden");
        });
      });
    });
  </script>
{% endblock %}
