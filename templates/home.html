{% extends "base.html" %}

{% block content %}
  <section class="grid">
    <a class="panel card-link image-card" href="{{ url_for('schedule') }}">
      <img
        class="card-image-top"
        src="{{ url_for('static', filename=(hero_images[0] if hero_images else 'img/mmm.png')) }}"
        alt="今日の記録とスケジュール"
        data-images='[
          {% for image in hero_images %}
            "{{ url_for("static", filename=image) }}"{% if not loop.last %},{% endif %}
          {% endfor %}
        ]'
        data-current-index="0"
      />
    </a>

    <a class="panel card-link schedule-card" href="{{ url_for('schedule') }}">
      <span class="card-meta">Next Schedule</span>
      <h2>次の予定</h2>
      {% if next_schedule %}
        <div class="schedule-meta schedule-date">{{ next_schedule.date or next_schedule.created_at }}</div>
        <div class="schedule-title">{{ next_schedule.title or "予定" }}</div>
        {% if next_schedule.detail %}
          <p class="schedule-snippet">{{ next_schedule.detail | truncate(60, True) }}</p>
        {% endif %}
      {% else %}
        <p class="schedule-snippet">予定はまだありません。</p>
      {% endif %}
      <span class="link-arrow">詳細へ -&gt;</span>
    </a>

    <a class="panel card-link icon-card" href="{{ url_for('places') }}">
      <span class="card-icon">
        <img src="{{ url_for('static', filename='mickey.jpg') }}" alt="行きたい場所" />
      </span>
      <h2>行きたい場所</h2>
    </a>
    <a class="panel card-link icon-card" href="{{ url_for('memo') }}">
      <span class="card-icon">
        <img src="{{ url_for('static', filename='mini.jpg') }}" alt="メモ" />
      </span>
      <h2>メモ</h2>
    </a>
    <a class="panel card-link icon-card" href="{{ url_for('games') }}">
      <span class="card-icon">
        <img src="{{ url_for('static', filename='dona.jpg') }}" alt="ゲーム" />
      </span>
      <h2>ゲーム</h2>
    </a>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const heroImage = document.querySelector(".card-image-top[data-images]");
      if (!heroImage) return;
      let images = [];
      try {
        images = JSON.parse(heroImage.dataset.images || "[]");
      } catch (e) {
        images = [];
      }
      if (!images.length) return;
      const today = new Date().toISOString().slice(0, 10);
      const storedIndex = Number(window.localStorage.getItem("heroImageIndex") || "0");
      const storedDate = window.localStorage.getItem("heroImageDate");
      let nextIndex = storedIndex;
      if (storedDate !== today) {
        nextIndex = (storedIndex + 1) % images.length;
        window.localStorage.setItem("heroImageDate", today);
        window.localStorage.setItem("heroImageIndex", String(nextIndex));
      }
      heroImage.src = images[nextIndex];
      heroImage.dataset.currentIndex = String(nextIndex);
    });
  </script>
{% endblock %}
